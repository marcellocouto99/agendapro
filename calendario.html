<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Calendário - Agenda PitStop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="menu.css">
  <link rel="stylesheet" href="calendario.css">
  <style>
    .status-box.ocupado { background:#dc3545; color:#fff; }
    .status-box.livre { background:#198754; color:#fff; }
  </style>
</head>
<body class="calendario-page">

  <!-- MENU -->
  <nav class="menu-lateral">
    <div class="btn-expandir"><i class="bi bi-list" id="btn-exp"></i></div>
    <ul>
      <li class="item-menu ativo"><a href="calendario.html"><span class="icon"><i class="bi bi-calendar3"></i></span><span class="txt-link">Calendário</span></a></li>
      <li class="item-menu"><a href="agendamentos.html"><span class="icon"><i class="bi bi-file-earmark-check"></i></span><span class="txt-link">Agendamento</span></a></li>
      <li class="item-menu"><a href="#"><span class="icon"><i class="bi bi-gear"></i></span><span class="txt-link">Configurações</span></a></li>
      <li class="item-menu"><a href="edicao.html"><span class="icon"><i class="bi bi-pencil-square"></i></span><span class="txt-link">Editar</span></a></li>
      <li class="item-menu"><a href="#"><span class="icon"><i class="bi bi-person-circle"></i></span><span class="txt-link">Conta</span></a></li>
      <li class="item-menu"><a href="#" id="logoutBtn"><span class="icon"><i class="bi bi-box-arrow-right"></i></span><span class="txt-link">Sair</span></a></li>
      <li class="logo-item">
        <span class="icon"><img src="img/LogoAgendaPro.png" alt="Logo AgendaPro" class="logo-agendapro"></span>
        <span class="txt-link">AgendaPro</span>
      </li>
    </ul>
  </nav>

  <!-- CONTEÚDO -->
  <main class="content">
    <div class="logo"><img src="img/LogoPitstop.png" alt="Logo" width="200" height="200"></div>
    <h1 class="titulo">Calendário<br>Colorado</h1>
    <h6 class="subtitulo">Veja as Cautelares Agendadas!</h6>

    <section class="calendar-section">
      <h2 class="section-title">1. Escolha a Data</h2>
      <div class="calendar-container">
        <div class="month-navigation">
          <button class="nav-btn prev-btn" id="prevMonth">&lt;</button>
          <div class="month-year" id="monthYear">JULHO 2025</div>
          <button class="nav-btn next-btn" id="nextMonth">&gt;</button>
        </div>
        <div class="days-header">
          <div class="day-header">D</div><div class="day-header">S</div><div class="day-header">T</div>
          <div class="day-header">Q</div><div class="day-header">Q</div><div class="day-header">S</div><div class="day-header">S</div>
        </div>
        <div class="calendar-grid" id="calendarGrid"></div>
      </div>
    </section>

    <!-- HORÁRIOS (apenas leitura/visualização) -->
    <section class="time-section" id="timeSection">
      <h2 class="section-title">2. Horários do Dia</h2>
      <div class="time-container">
        <div class="time-slots" id="timeSlots">
          <div class="time-slot-block"><button class="time-slot" data-time="0900" disabled>09:00</button><div class="status-box" id="status-0900">Livre</div></div>
          <div class="time-slot-block"><button class="time-slot" data-time="1000" disabled>10:00</button><div class="status-box" id="status-1000">Livre</div></div>
          <div class="time-slot-block"><button class="time-slot" data-time="1100" disabled>11:00</button><div class="status-box" id="status-1100">Livre</div></div>
          <div class="time-slot-block"><button class="time-slot" data-time="1400" disabled>14:00</button><div class="status-box" id="status-1400">Livre</div></div>
          <div class="time-slot-block"><button class="time-slot" data-time="1500" disabled>15:00</button><div class="status-box" id="status-1500">Livre</div></div>
          <div class="time-slot-block"><button class="time-slot" data-time="1600" disabled>16:00</button><div class="status-box" id="status-1600">Livre</div></div>
        </div>
      </div>
    </section>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
    import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
    import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBihcx1ihMSs7egInoGOzV1mWIw9D8LUzw",
      authDomain: "agendapro-f6ecc.firebaseapp.com",
      projectId: "agendapro-f6ecc",
      storageBucket: "agendapro-f6ecc.firebasestorage.app",
      messagingSenderId: "1045418539073",
      appId: "1:1045418539073:web:aa920e129ece148c0feec0"
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    onAuthStateChanged(auth, (user)=>{
      if (!user) window.location.href = "index.html";
    });

    document.getElementById("logoutBtn").addEventListener("click", async (e)=>{
      e.preventDefault();
      if (!confirm("Tem certeza que deseja sair da conta?")) return;
      await signOut(auth);
      window.location.href = "index.html";
    });

    // ---- calendário (render e seleção) ----
    const monthYear = document.getElementById("monthYear");
    const calendarGrid = document.getElementById("calendarGrid");
    const prevMonth = document.getElementById("prevMonth");
    const nextMonth = document.getElementById("nextMonth");
    const monthNames = ['JANEIRO','FEVEREIRO','MARÇO','ABRIL','MAIO','JUNHO','JULHO','AGOSTO','SETEMBRO','OUTUBRO','NOVEMBRO','DEZEMBRO'];
    let currentDate = new Date();
    let selectedDateISO = null;

    function pad(n){ return n.toString().padStart(2,'0'); }
    function toISO(d){ return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`; }

    function renderCalendar(){
      monthYear.textContent = `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
      calendarGrid.innerHTML = "";
      const y = currentDate.getFullYear();
      const m = currentDate.getMonth();
      const first = new Date(y, m, 1);
      const last = new Date(y, m+1, 0);
      const startWeekday = first.getDay();

      for (let i=0;i<startWeekday;i++){
        const div = document.createElement("div");
        div.className = "calendar-day other-month";
        calendarGrid.appendChild(div);
      }
      for (let d=1; d<=last.getDate(); d++){
        const div = document.createElement("div");
        div.className = "calendar-day";
        div.textContent = d;
        div.addEventListener("click", ()=>{
          document.querySelectorAll(".calendar-day.selected").forEach(el=>el.classList.remove("selected"));
          div.classList.add("selected");
          const sel = new Date(y, m, d);
          selectedDateISO = toISO(sel);
          carregarStatusDoDia(selectedDateISO);
        });
        calendarGrid.appendChild(div);
      }
    }
    prevMonth.addEventListener("click",()=>{ currentDate.setMonth(currentDate.getMonth()-1); renderCalendar(); });
    nextMonth.addEventListener("click",()=>{ currentDate.setMonth(currentDate.getMonth()+1); renderCalendar(); });
    renderCalendar();

    // ---- status dos horários (somente visual) ----
    const statusIds = ["0900","1000","1100","1400","1500","1600"];
    function limparStatus(){
      statusIds.forEach(t=>{
        const box = document.getElementById(`status-${t}`);
        if (box){
          box.textContent = "Livre";
          box.classList.remove("ocupado");
          box.classList.add("livre");
        }
      });
    }
    async function carregarStatusDoDia(dateISO){
      limparStatus();
      const q = query(collection(db,"agendamentos"), where("dateISO","==",dateISO));
      const snap = await getDocs(q);
      const ocupados = new Set();
      snap.forEach(doc=> { const d = doc.data(); if (d.time) ocupados.add(d.time); });
      ocupados.forEach(t=>{
        const box = document.getElementById(`status-${t}`);
        if (box){
          box.textContent = "Ocupado";
          box.classList.remove("livre");
          box.classList.add("ocupado");
        }
      });
    }
  </script>

  <script src="menu.js"></script>
</body>
</html>
